{% extends "base.html" %}


{% block content %}

    <script>
        $(document).ready(function(){
            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd',
                todayBtn: true
            });

            $('#formato').change(function(){
                if ($(this).val() == 'grafico' || $(this).val() == 'graficoPorAnio')
                {
                    $('#variableInput').show();
                }
                else
                {
                    $('#variableInput').hide();
                }
            });

            $('#formReporteAnual').submit(function(e){

                e.preventDefault();
                e.stopPropagation();

                if ($('#estacion').val() == null)
                {
                    alert('Debe seleccionar por lo menos una estacion');
                    return false;
                }

                var estaciones = $('#estacion').val();
                var desde = $('#fecha_desde').val();
                var hasta = $('#fecha_hasta').val();
                var formato = $('#formato').val();
                var periodo = $('#periodo').val();
                var variable = $('#variable').val();

                var url = '/reporte/periodo/tabla?desde='+desde+'&hasta='+hasta+'&estacion='+estaciones+'&formato='+formato+'&periodo='+periodo;

                if (formato == 'grafico' ||formato == 'graficoPorAnio')
                {
                    // cargar datos y generar grafico
                    EstacionGrafico.graficoPorEstacion(url, formato, variable);
                }
                else
                {
                    window.location.href = url;    
                }
                

                return false;
            });

        });
    </script>

    <div class="container">

        <h1 id="helper-classes" class="page-header">Reporte por Estacion</h1>

        <form id="formReporteAnual" class="form-horizontal" method="GET">

          <div class="form-group">
            <label for="inputEmail3" class="col-sm-2 control-label">Estaciones</label>
            <div class="col-sm-10">
                <select id="estacion" name="estacion" class="form-control">
                    {% for estacion in estaciones %}
                        <option value="{{ estacion.pk }}">{{ estacion.name }}</option>
                    {% endfor %}    
                </select>
            </div>
          </div>
          <div class="form-group">
            <label for="inputEmail3" class="col-sm-2 control-label">Desde</label>
            <div class="col-sm-10">
              <input type="text" class="form-control datepicker" id="fecha_desde" name="fecha_desde" placeholder="Fecha Desde">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Hasta</label>
            <div class="col-sm-10">
              <input type="text" class="form-control datepicker" id="fecha_hasta" name="fecha_hasta" placeholder="Fecha Hasta">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Promedio</label>
            <div class="col-sm-10">
                <select id="periodo" name="periodo" class="form-control">
                    <option value="hora">Por hora</option>
                    <option value="dia">Por dia</option>
                    <option value="mes">Por mes</option>
                </select>
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label">Formato de Salida</label>
            <div class="col-sm-10">
                <select id="formato" name="formato" class="form-control">
                    <option value="tabla">Tabla</option>
                    <option value="csv">CSV</option>
                    <option value="grafico">Grafico</option>
                    <option value="graficoPorAnio">Grafico Anual</option>
                </select>
            </div>
          </div>
          <div class="form-group" style="display: none;" id="variableInput">
            <label for="inputPassword3" class="col-sm-2 control-label">Variable</label>
            <div class="col-sm-10">
                <select id="variable" name="variable" class="form-control">
                    <option value="winddir">Viento Direccion</option>
                    <option value="windspeed">Viento Velocidad</option>
                    <option value="temperatura">Temperatura</option>
                    <option value="presion">presion</option>
                </select>
            </div>
          </div>
          
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <button type="submit" class="btn btn-default">Generar</button>
            </div>
          </div>
        </form>

        <div class="chart-panel pad3"></div>

    </div> <!-- /container -->


{% endblock %}

